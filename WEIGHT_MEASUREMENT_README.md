# 称重测量系统 - 集成版

## 概述

这个称重测量系统是基于传感器驱动系统开发的集成版本，将原有的称重功能迁移到了传感器驱动框架中，提供了更强大的数据处理能力和更灵活的校准功能。

## 功能特性

### 🎯 核心功能
- **实时称重测量**: 基于压力传感器数据进行实时重量计算
- **热力图显示**: 64x64压力分布热力图，支持自动缩放和重置
- **校准系统**: 支持多种校准文件格式（JSON、NumPy、CSV）
- **归零功能**: 动态归零，消除环境干扰
- **历史记录**: 实时重量变化曲线显示
- **稳定性分析**: 实时计算测量稳定性

### 🔧 校准功能
- **Balance-Sensor校准集成**: 支持原有的balance-sensor校准文件
- **多种格式支持**: JSON、NumPy、CSV格式的校准文件
- **实时参数调整**: 可动态调整校准系数和偏置
- **校准信息显示**: 详细的校准状态和参数信息

### 📊 数据可视化
- **压力分布热力图**: 正方形显示，Y轴朝下
- **重量历史曲线**: 实时更新的重量变化图表
- **实时信息面板**: 压力、净压力、稳定性等关键指标

## 文件结构

```
sensor_driver/
├── interfaces/ordinary/
│   └── weight_measurement_interface.py    # 主界面文件
├── calibration_data/
│   ├── position_calibration_data.json     # 位置校准数据
│   └── 校正数据-200帧.npy                 # 一致性测试校准数据
├── run_weight_measurement.py              # 启动脚本
└── WEIGHT_MEASUREMENT_README.md           # 本说明文件
```

## 使用方法

### 1. 启动程序

```bash
cd sensor_driver
python run_weight_measurement.py
```

### 2. 连接传感器

1. 在左侧"传感器控制"面板中选择传感器类型
2. 输入端口号（通常为"0"）
3. 点击"连接传感器"按钮

### 3. 加载校准文件

1. 点击"加载校准"按钮
2. 选择校准文件（支持JSON、NumPy、CSV格式）
3. 系统会自动应用校准参数

### 4. 执行归零

1. 确保传感器已连接
2. 点击"归零"按钮设置基准压力

### 5. 开始测量

1. 点击"开始测量"按钮
2. 观察实时重量显示和历史曲线
3. 使用"保持读数"功能稳定显示
4. 点击"停止测量"结束

## 校准文件说明

### 位置校准数据 (position_calibration_data.json)
- 包含传感器位置相关的校准参数
- 用于补偿传感器阵列中的位置偏差

### 一致性测试校准数据 (校正数据-200帧.npy)
- 包含200帧的一致性测试数据
- 用于提高测量的稳定性和准确性

## 界面布局

### 左侧面板 (25%)
- **传感器控制**: 连接/断开传感器
- **压力信息**: 总压力、最大压力、最小压力
- **热力图**: 压力分布可视化
- **校准信息**: 校准文件状态和参数

### 右侧面板 (75%)
- **校准参数**: 系数和偏置设置
- **归零控制**: 归零操作和状态
- **重量显示**: 大字体LCD数字显示
- **测量控制**: 开始/停止/保持/清空
- **实时信息**: 压力、净压力、稳定性
- **历史记录**: 重量变化曲线

## 技术特性

### 数据处理
- **实时更新**: 100ms更新频率
- **数据校准**: 支持多种校准算法
- **噪声过滤**: 内置滤波和插值功能

### 可视化
- **PyQtGraph**: 高性能图表库
- **热力图**: 支持颜色映射和缩放
- **实时曲线**: 流畅的历史数据展示

### 校准算法
- **线性校准**: 质量 = k × 压力 + b
- **位置校准**: 补偿传感器位置偏差
- **一致性校准**: 提高测量稳定性

## 故障排除

### 常见问题

1. **传感器连接失败**
   - 检查端口号是否正确
   - 确认传感器硬件连接
   - 检查驱动程序安装

2. **校准文件加载失败**
   - 确认文件格式正确
   - 检查文件路径
   - 验证文件完整性

3. **热力图显示异常**
   - 点击"重置缩放"按钮
   - 检查数据格式是否为64x64
   - 确认传感器数据正常

4. **重量计算不准确**
   - 重新执行归零操作
   - 检查校准参数设置
   - 验证校准文件是否正确加载

### 调试信息

程序运行时会输出详细的调试信息：
- ✅ 成功操作
- ⚠️ 警告信息
- ❌ 错误信息

## 扩展功能

### 自定义校准
可以通过修改代码添加新的校准算法：
1. 在`data_handler.py`中添加新的校准适配器
2. 在界面中添加相应的控制选项
3. 更新校准信息显示

### 数据导出
可以扩展数据导出功能：
1. 添加CSV导出
2. 支持数据库存储
3. 实时数据流输出

## 版本信息

- **版本**: 1.0.0
- **开发框架**: PyQt5 + PyQtGraph
- **传感器驱动**: 集成版
- **校准系统**: Balance-Sensor兼容

## 联系方式

如有问题或建议，请联系开发团队。 